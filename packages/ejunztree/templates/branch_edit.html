{% import "components/form.html" as form with context %}
{% extends "layout/basic.html" %}
{% block content %}

<script>
  {{ set(UiContext, {
    ddoc: ddoc,
    docs: docs,
    repos: repos,
    resources: resources
  }) }}
</script>

{% set has_docs = docs and docs|length > 0 %}
{% set has_problems = problems and problems|length > 0 %}
{% set has_htdocs = htdocs and htdocs|length > 0 %}
{% set has_tdocs = tdocs and tdocs|length > 0 %}
{% set has_ctdocs = ctdocs and ctdocs|length > 0 %}
{% set has_repos = repos and repos|length > 0 %}
{% set has_related_content = has_docs or has_problems or has_htdocs or has_tdocs or has_ctdocs or has_repos %}

<div class="row" style="display: flex; flex-wrap: nowrap; align-items: flex-start;">

  {% if has_related_content %}
  <div class="medium-3 columns">
    {% if has_docs %}
    <div class="section">
      <div class="section__header">
        <h3>{{ _("Related Docs") }}</h3>
      </div>
      <div class="section__body">
        <ul>
          {% for doc in docs %}
          <li>
            <a class="discussion-node-tag media-link resource-link" 
               data-resource="{{ doc.title }}"
               href="javascript:void(0)"
               onclick="copyResourceUrl(this)">
              <span class="v-center icon icon-doc"></span> {{ doc.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}

    {% if has_problems %}
    <div class="section">
      <div class="section__header">
        <h3>{{ _("Related Problems") }}</h3>
      </div>
      <div class="section__body">
        <ul>
          {% for problem in problems %}
          <li>
            <a class="discussion-node-tag media-link resource-link" 
               data-resource="{{ problem.title }}"
               href="javascript:void(0)"
               onclick="copyResourceUrl(this)">
              <span class="v-center icon icon-problem"></span> {{ problem.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}

    {% if has_htdocs %}
    <div class="section">
      <div class="section__header">
        <h4>{{ _("Related Homework") }}</h4>
      </div>
      <div class="section__body">
        <ul>
          {% for htdoc in htdocs %}
          <li>
            <a class="discussion-node-tag media-link resource-link" 
               data-resource="{{ htdoc.title }}"
               href="javascript:void(0)"
               onclick="copyResourceUrl(this)">
              <span class="v-center icon icon-homework"></span> {{ htdoc.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}

    {% if has_tdocs %}
    <div class="section">
      <div class="section__header">
        <h4>{{ _("Problems Related Training Plans") }}</h4>
      </div>
      <div class="section__body">
        <ul>
          {% for tdoc in tdocs %}
          <li>
            <a class="discussion-node-tag media-link resource-link" 
               data-resource="{{ tdoc.title }}"
               href="javascript:void(0)"
               onclick="copyResourceUrl(this)">
              <span class="v-center icon icon-training"></span> {{ tdoc.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}

    {% if has_ctdocs %}
    <div class="section">
      <div class="section__header">
        <h4>{{ _("Related Contest") }}</h4>
      </div>
      <div class="section__body">
        <ul>
          {% for ctdoc in ctdocs %}
          <li>
            <a class="discussion-node-tag media-link resource-link" 
               data-resource="{{ ctdoc.title }}"
               href="javascript:void(0)"
               onclick="copyResourceUrl(this)">
              <span class="v-center icon icon-contest"></span> {{ ctdoc.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}

    {% if has_repos %}
    <div class="section">
      <div class="section__header">
        <h3>{{ _("Related Repositories") }}</h3>
      </div>
      <div class="section__body">
        {% for repo in repos %}
        <div class="repo-section">
          <h5>
            <a class="discussion-node-tag media-link resource-link" 
               data-resource="{{ repo.title }}"
               href="javascript:void(0)"
               onclick="copyResourceUrl(this)">
              <span class="v-center icon icon-repo"></span> {{ repo.title }}
            </a>
          </h5>
          {% if repo.files and repo.files|length > 0 %}
          <ul>
            {% for file in repo.files %}
            <li>
              <a class="resource-link"
                 data-resource="{{ file.filename }}"
                 href="javascript:void(0)"
                 onclick="copyResourceUrl(this)">
                <span class="v-center icon icon-file"></span> {{ file.filename }} (v{{ file.version }})
              </a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p>{{ _("No files available.") }}</p>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
  {% endif %}

  {# üåü Âè≥‰æßÂÜÖÂÆπÂå∫ÂüüËá™Âä®Ë∞ÉÊï¥ #}
  <div class="{% if has_related_content %}medium-8{% else %}medium-12{% endif %} columns">
    <div class="section">
      <div class="section__header">
        <h2 class="section__title">
          {% if ddoc %}
            {{ _("Edit Branch") }}
          {% elif parentId %}
            {{ _("Create Sub-Branch") }}
          {% else %}
            {{ _("Create Branch") }}
          {% endif %}
        </h2>
      </div>
      <div class="section__body">
        <form method="post">
          {% if parentId %}
            <input type="hidden" name="parentId" value="{{ parentId }}">
          {% endif %}

          {{ form.form_text({
              columns:12,
              label:_('Branch Title'),
              name:'title',
              placeholder:_('Enter branch title'),
              value:ddoc.title|default(''),
              autofocus:true
          }) }}

          {% if ddoc %}
            {{ form.form_textarea({
                columns:12,
                label:_('Branch Content'),
                name:'content',
                value:ddoc.content|default(''),
                markdown:true
            }) }}
          {% endif %}

          <div class="row">
            <div class="columns">
              <button type="submit" class="rounded primary button">
                {{ _('Submit') }}
              </button>
              <button type="button" class="rounded button" onclick="window.history.go(-1)">
                {{ _('Cancel') }}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
<div class="medium-3 columns">
    {% include 'components/md_hint.html' %}
  </div>

</div>

{% endblock %}
