{% extends "layout/basic.html" %}

{% block content %}
<div class="row">
  <div class="medium-9 columns">
    <div class="section">
      <div class="section__header">
        <h2 class="section__title">{{ _("Tree Details") }}</h2>
      </div>
      <div class="section__body">
        {% if tree %}
          <h3>{{ _("Tree Title") }}: {{ tree.title }}</h3>
          <p>{{ _("Tree ID") }}: {{ tree.trid }}</p>

          <h4>{{ _("Structured Document") }}</h4>

          <div class="document">
            {% if branchHierarchy.trunk %}
              <h2 class="branch-title">
                1. {{ branchHierarchy.trunk.title }}
              </h2>
              <div class="branch-content">
                <p><a href="{{ url('branch_detail', domainId=tree.domainId, docId=branchHierarchy.trunk.docId) }}">{{ _("View Details") }}</a></p>
              </div>
            {% endif %}

            {% if branchHierarchy.branches %}
              {{ render_tree(branchHierarchy.branches, "1") }}
            {% endif %}
          </div>

        {% else %}
          <p>{{ _("Tree not found.") }}</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="medium-3 columns">
    <div class="section side">
      <div class="section__header">
        <h2 class="section__title">{{ _("Actions") }}</h2>
      </div>
      <div class="section__body">
        {% if tree %}
          {% if not treeBranches or treeBranches|length == 0 %}
            <a href="{{ url('branch_create', domainId=tree.domainId, trid=tree.trid) }}" 
               class="button primary expanded">
              {{ _('Create Branch') }}
            </a>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
{% macro render_tree(branches, prefix) %}
  <ul class="branch-list">
    {% for branch in branches %}
      {% set branch_number = prefix + "." + (loop.index0 + 1)|string %}
      <li class="branch-item">
        <h3 class="branch-title">
          <a href="{{ url('branch_detail', domainId=tree.domainId, docId=branch.docId) }}">
            {{ branch_number }} {{ branch.title }}
          </a>
        </h3>
        <div class="branch-content">
          <p><strong>{{ _("Content") }}:</strong> {{ branch.content }}</p>

        

          {% if branch.subBranches and branch.subBranches|length > 0 %}
            {{ render_tree(branch.subBranches, branch_number) }}
          {% endif %}
        </div>
      </li>
    {% endfor %}
  </ul>
{% endmacro %}
