{% extends "layout/basic.html" %}

{% block content %}
<div class="row">
  <div class="medium-9 columns">
    <div class="section">
      <div class="section__header">
        <h2 class="section__title">{{ _("Branch Details") }}</h2>
      </div>
      <div class="section__body">
        <h2>{{ _("Tree ID") }}: {{ ddoc.trid }}</h2>

          <!-- ðŸ”¹ Current Branch -->
        <div class="section">
          <div class="section__header">
            <h3>{{ _("Current Branch") }}</h3>
          </div>
          <div class="section__body current-branch">
            <p><strong>{{ _("Title") }}:</strong> {{ ddoc.title }}</p>
            <p><strong>{{ _("Branch ID") }}:</strong> {{ ddoc.bid }}</p>
            <p><strong>{{ _("Type") }}:</strong> 
              {% if ddoc.parentId %}
                <span class="badge secondary">{{ _("Sub-Branch") }}</span>
              {% else %}
                <span class="badge primary">{{ _("Trunk") }}</span>
              {% endif %}
            </p>
            <p><strong>{{ _("Content") }}:</strong> {{ ddoc.content }}</p>
          </div>
        </div>

        <div class="section">
          <div class="section__header">
            <h3>{{ _("Hooked Resorces") }}</h3>
            <div class="section__body">
            <h4>{{ _("Related Docs") }}</h4>
        <ul>
                {% for doc in docs %}
        <li>
          <a class="discussion-node-tag media-link" href="{{ url('docs_detail', domainId=ddoc.domainId, lid=doc.lid | default(doc.docId)) }}">
            <span class="v-center icon icon-problem"></span> {{ doc.title }}
          </a>
        </li>
      {% endfor %}
        </ul>

      {% if repos|length > 0 %}
<h4>{{ _("Related Repositories") }}</h4>
{% for repo in repos %}
<div class="repo-section">
  <h5>{{ repo.title }}</h5>
  {% if repo.files|length > 0 %}
  <table class="table">
    <thead>
      <tr>
        <th>{{ _("Version") }}</th>
        <th>{{ _("Filename") }}</th>
        <th>{{ _("Size") }}</th>
        <th>{{ _("Last Modified") }}</th>
        <th>{{ _("Actions") }}</th>
      </tr>
    </thead>
    <tbody>
      {% for file in repo.files %}
      <tr>
        <td class="col--version">{{ file.version }}</td>
        <td class="col--name" data-preview>
          <a href="{{ url('repo_file_download', domainId=ddoc.domainId, rid=repo.rid, filename=file.filename) }}">
            {{ file.filename }}
          </a>
        </td>
        <td class="col--size">{{ size(file.size) }}</td>
        <td class="col--modified">{{ file.lastModified }}</td>
        <td class="col--operation">
          <a href="{{ url('repo_file_download', domainId=ddoc.domainId, rid=repo.rid, filename=file.filename) }}" 
             class="icon icon-download" title="{{ _('Download') }}"></a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>{{ _("No files available.") }}</p>
  {% endif %}
</div>
{% endfor %}
{% endif %}



          {% if problems|length > 0 %}
          <h4>{{ _("Related Problems") }}</h4>
          <ul>
            {% for problem in problems %}
            <li>
              <a class="discussion-node-tag media-link" href="{{ url('problem_detail', domainId=problem.domainId, pid=problem.docId) }}">
                <span class="v-center icon icon-problem"></span>{{ problem.title }}
              </a>
            </li>
            {% endfor %}
            {% endif %}
          
          {% if tdocs|length > 0 %}
          <h4>{{ _("Problems Related Training Plans") }}</h4>
          <ul>
            {% for tdoc in tdocs %}
            <li>
              <a class="discussion-node-tag media-link" href="{{ url('training_detail', domainId=tdoc.domainId, tid=tdoc.docId) }}">
                <span class="v-center icon icon-problem"></span>{{ tdoc.title }}
              </a>
            </li>
            {% endfor %}
            {% endif %}

            {% if ctdocs|length > 0 %}
            <h4>{{ _("Problems Related Contests") }}</h4>
            <ul>
              {% for ctdoc in ctdocs %}
              <li>
                <a class="discussion-node-tag media-link" href="{{ url('contest_detail', domainId=ctdoc.domainId, tid=ctdoc.docId) }}">
                  <span class="v-center icon icon-problem"></span>{{ ctdoc.title }}
                </a>
              </li>
              {% endfor %}
              {% endif %}

              {% if htdocs|length > 0 %}
              <h4>{{ _("Problems Related Homework") }}</h4>
              <ul>
                {% for htdoc in htdocs %}
                <li>
                  <a class="discussion-node-tag media-link" href="{{ url('homework_detail', domainId=htdoc.domainId, tid=htdoc._id) }}">
                    <span class="v-center icon icon-problem"></span>{{ htdoc.title }}
                  </a>
                </li>
                {% endfor %}
                {% endif %}
              
              {% if tdocs|length > 0 %}
              <h4>{{ _("Problems Related Training Plans") }}</h4>
              <ul>
                {% for tdoc in tdocs %}
                <li>
                  <a class="discussion-node-tag media-link" href="{{ url('training_detail', domainId=tdoc.domainId, tid=tdoc.docId) }}">
                    <span class="v-center icon icon-problem"></span>{{ tdoc.title }}
                  </a>
                </li>
                {% endfor %}
                {% endif %}

      </div>
    </div>
   </div>

        <!-- ðŸŒ³ Tree Map -->
        <div class="section">
          <div class="section__header">
            <h3>{{ _("Tree Map") }}</h3>
          </div>
          <div class="section__body">
            {% include "tree_map.html" %}
          </div>
        </div>

        <!-- ðŸ”¹ Branch Path -->
        <div class="section">
          <div class="section__header">
            <h3>{{ _("Branch Path") }}</h3>
          </div>
          <div class="section__body path-container">
            <nav class="breadcrumb">
              {% for pathBranch in pathBranches %}
                {% if pathBranch.docId == ddoc.docId %}
                  <strong>{{ pathBranch.title }}</strong>
                {% else %}
                  <a href="{{ url('branch_detail', domainId=ddoc.domainId, docId=pathBranch.docId) }}">
                    {{ pathBranch.title }}
                  </a>
                {% endif %}
                {% if not loop.last %} - {% endif %}
              {% endfor %}
            </nav>
          </div>
        </div>

      
        <!-- ðŸ”¹ Sub-Branches -->
        <div class="section">
          <div class="section__header">
            <h3>{{ _("Sub-Branches") }}</h3>
          </div>
          <div class="section__body sub-branches">
            {% if childrenBranches and childrenBranches|length > 0 %}
              {% for branch in childrenBranches %}
                <a href="{{ url('branch_detail', domainId=ddoc.domainId, docId=branch.docId) }}">
                  {{ branch.title }}
                </a>
                {% if not loop.last %} | {% endif %}
              {% endfor %}
            {% else %}
              <p>{{ _("No sub-branches available.") }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="medium-3 columns">
    <div class="section side">
      <div class="section__header">
        <h2 class="section__title">{{ _("Actions") }}</h2>
      </div>
      <div class="section__body">
        <a href="{{ url('branch_edit', domainId=ddoc.domainId, docId=ddoc.docId) }}" class="button primary expanded">
          {{ _('Edit Branch') }}
        </a>
        <a href="{{ url('tree_domain', domainId=ddoc.domainId) }}" class="button expanded">
          {{ _('Back to Tree') }}
        </a>
        <a href="{{ url('branch_create_subbranch', domainId=ddoc.domainId, parentId=ddoc.bid) }}" class="button success expanded">
          {{ _('Create Sub-Branch') }}
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
