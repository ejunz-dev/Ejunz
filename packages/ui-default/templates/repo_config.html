{% import "components/form.html" as form with context %}
{% extends "layout/basic.html" %}

{% block content %}
<div class="row">
  <div class="medium-9 columns">
    <div class="section">
      <div class="section__header">
        <h2 class="section__title">{{ _("Repo Config") }}</h2>
      </div>
      <div class="section__body">
        <form method="post">
          {{ form.form_text({
              columns: 12,
              label: _('GitHub Repository'),
              name: 'githubRepo',
              placeholder: _('e.g., git@github.com:user/repo.git or user/repo'),
              value: repo.githubRepo|default(''),
              autofocus: true
          }) }}

          <div class="row">
            <div class="columns">
              <button type="submit" class="rounded primary button">
                {{ _('Save Config') }}
              </button>
              <button type="button" class="rounded button" onclick="window.history.go(-1)">
                {{ _('Cancel') }}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- MCP Tools Management Section -->
    <div class="section" style="margin-top: 20px;">
      <div class="section__header">
        <h2 class="section__title">{{ _("MCP Tools") }}</h2>
        <p class="section__help-text">
          {{ _("Manage MCP tools for this repo. These tools will be available when this repo is assigned to an agent.") }}
        </p>
      </div>
      <div class="section__body">
        {% if repo.mcpServerId %}
          <div class="mcp-tools-list">
            {% if mcpTools and mcpTools.length > 0 %}
              <table class="data-table">
                <thead>
                  <tr>
                    <th>{{ _('Tool Name') }}</th>
                    <th>{{ _('Description') }}</th>
                    <th>{{ _('Type') }}</th>
                    <th>{{ _('Actions') }}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for tool in mcpTools %}
                  <tr>
                    <td><code>{{ tool.name }}</code></td>
                    <td>{{ tool.description }}</td>
                    <td>
                      {% if 'query' in tool.name %}
                        <span class="badge badge--success">{{ _('Query') }}</span>
                      {% elif 'create' in tool.name %}
                        <span class="badge badge--primary">{{ _('Create') }}</span>
                      {% elif 'edit' in tool.name %}
                        <span class="badge badge--warning">{{ _('Edit') }}</span>
                      {% elif 'delete' in tool.name %}
                        <span class="badge badge--danger">{{ _('Delete') }}</span>
                      {% else %}
                        <span class="badge">{{ _('Custom') }}</span>
                      {% endif %}
                    </td>
                    <td>
                      <details style="font-size: 0.85em;">
                        <summary style="cursor: pointer;">{{ _('View Schema') }}</summary>
                        <pre style="margin-top: 5px; padding: 5px; background: #f5f5f5; border-radius: 3px; overflow-x: auto;">{{ tool.inputSchema|json }}</pre>
                      </details>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="note">{{ _('No MCP tools found. Default tools should be created automatically when the repo is created.') }}</p>
            {% endif %}
          </div>
        {% else %}
          <p class="note">{{ _('MCP server not found for this repo. Please contact administrator.') }}</p>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="medium-3 columns">
    <div class="section">
      <div class="section__header">
        <h3 class="section__title">{{ _("Help") }}</h3>
      </div>
      <div class="section__body">
        <p>{{ _("Configure the GitHub repository URL for this repo.") }}</p>
        <p>{{ _("Supported formats:") }}</p>
        <ul>
          <li><code>git@github.com:user/repo.git</code></li>
          <li><code>user/repo</code></li>
          <li><code>https://github.com/user/repo.git</code></li>
        </ul>
        <p>{{ _("Note: GitHub token should be configured in system settings.") }}</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

