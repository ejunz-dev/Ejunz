{% set _current_domain_id = (UiContext and UiContext.domainId) or (handler.context and handler.context.domainId) or (handler.domain and handler.domain._id) or 'system' %}
<div id="menu-domains" class="slideout-menu slideout-menu--left domains-slideout" aria-hidden="true">
  <header class="domains-slideout__header">{{ _('Joined Domains') }}</header>
  <div class="domains-slideout__scroll" role="region" aria-label="{{ _('Joined Domains') }}">
    <ul class="domains-slideout__list">
      <li class="domains-slideout__item">
        <a href="{{ url('user_learn', uid=handler.user._id) }}" class="domains-slideout__link">{{ _('All Domains Learn') }}</a>
      </li>
      <li class="domains-slideout__item">
        <a href="{{ url('user_task', uid=handler.user._id) }}" class="domains-slideout__link">{{ _('My Task') }}</a>
      </li>
      <li class="domains-slideout__seperator" role="separator"></li>
      {%- set _user_domains = handler.user.joinedDomains|default(handler.user.domains)|default([]) -%}
      {%- for ddoc in _user_domains -%}
      <li class="domains-slideout__item">
        <a href="{{ url('homepage', domainId=ddoc['_id']) }}" class="domains-slideout__link{% if ddoc['_id'] == _current_domain_id %} nav--active{% endif %}" data-domain-id="{{ ddoc['_id'] }}">
          <span class="domains-slideout__avatar"><img class="small user-profile-avatar v-center" loading="lazy" src="{{ avatarUrl(ddoc.avatar|default('')) }}" width="20" height="20" alt=""></span>
          <span class="domains-slideout__name">{{ ddoc['name'] }}{% if ddoc['name'] != ddoc['_id'] %} ({{ ddoc['_id'] }}){% endif %}</span>
        </a>
      </li>
      {%- endfor -%}
    </ul>
  </div>
  <footer class="domains-slideout__footer">
    <a href="{{ url('home_domain') }}" class="domains-slideout__footer-link">
      <span class="icon icon-wrench"></span> {{ _('My Domains') }}
    </a>
  </footer>
</div>
