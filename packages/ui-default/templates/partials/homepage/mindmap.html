{% set mindMaps = payload %}
{% import "components/user.html" as user with context %}
{% if mindMaps and mindMaps.length %}
  <div class="section page--mindmap_main">
    <div class="section__header">
      <h1 class="section__title">{{ _('MindMap') }}</h1>
    </div>
    <ol class="section__list">
      {%- for mindMap in mindMaps -%}
        {% if mindMap and mindMap.docId %}
          {% set currentDomainId = domain._id|default(handler.args.domainId|default('system')) %}
          <li class="section__list__item">
            <div class="media">
              <div class="media__body medium">
                <h1 class="section__item-title">
                  <a href="{{ url('mindmap_detail', domainId=currentDomainId, docId=mindMap.docId) }}" data-emoji-enabled>
                    {{ mindMap.title|default('Untitled') }}
                  </a>
                </h1>
              <ul class="supplementary list">
                {% if mindMap.content %}
                  <li>{{ mindMap.content|truncate(100) }}</li>
                {% endif %}
                <li>
                  <span class="icon icon-eye"></span>
                  {{ _('Views') }}: {{ mindMap.views|default(0) }}
                </li>
                <li>
                  <span class="icon icon-nodes"></span>
                  {{ _('Nodes') }}: {{ (mindMap.nodes|length if mindMap.nodes else 0) }}
                </li>
                <li>
                  {% if mindMap.owner and udict[mindMap.owner] %}
                    {{ user.render_inline(udict[mindMap.owner]) }}
                  {% elif mindMap.owner %}
                    {{ _('User') }} #{{ mindMap.owner }}
                  {% else %}
                    {{ _('Unknown User') }}
                  {% endif %}
                  @
                  {% if mindMap.updateAt %}
                    {{ datetimeSpan(mindMap.updateAt)|safe }}
                  {% elif mindMap.createdAt %}
                    {{ datetimeSpan(mindMap.createdAt)|safe }}
                  {% else %}
                    N/A
                  {% endif %}
                </li>
              </ul>
            </div>
          </div>
        </li>
        {% endif %}
      {%- endfor -%}
    </ol>
    <ul class="pager pager-bottom"><li>
      <a class="pager__item next link" href="{{ url('mindmap_domain') }}">{{ _('More') }} ></a>
    </li></ul>
  </div>
{% endif %}

