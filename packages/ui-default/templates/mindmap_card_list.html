{% extends "layout/basic.html" %}
{% block content %}
<script>
  {% set baseUrlValue = url("mindmap_card_list_branch", domainId=mindMap.domainId, docId=mindMap.docId, branch=branch, nodeId=nodeId) %}
  {{ set(UiContext, 'currentBranch', branch) }}
  {{ set(UiContext, 'mindMap', {
    domainId: mindMap.domainId,
    docId: mindMap.docId,
    mmid: mindMap.mmid,
    currentBranch: branch
  }) }}
  {{ set(UiContext, 'cards', cards) }}
  {{ set(UiContext, 'baseUrl', baseUrlValue) }}
  {{ set(UiContext, 'nodeId', nodeId) }}
</script>
<div class="row mindmap-card-list">
  <!-- å·¦ä¾§ï¼šå¡ç‰‡åˆ—è¡¨ä¾§è¾¹æ  -->
  <div class="mindmap-card-list__sidebar">
    <div class="mindmap-card-list__header">
      <h2 class="mindmap-card-list__title">å¡ç‰‡åˆ—è¡¨</h2>
      <div class="mindmap-card-list__actions">
        <button 
          id="edit-mode-btn"
          class="mindmap-card-list__action-btn mindmap-card-list__action-btn--edit"
          title="{{ _('ç¼–è¾‘') }}"
        >
          âœ
        </button>
        <button 
          id="save-order-btn"
          class="mindmap-card-list__action-btn mindmap-card-list__action-btn--save"
          style="display: none;"
          title="{{ _('ä¿å­˜') }}"
        >
          âœ“
        </button>
        <button 
          id="cancel-edit-btn"
          class="mindmap-card-list__action-btn mindmap-card-list__action-btn--cancel"
          style="display: none;"
          title="{{ _('å–æ¶ˆ') }}"
        >
          Ã—
        </button>
        <button 
          id="delete-cards-btn"
          class="mindmap-card-list__action-btn mindmap-card-list__action-btn--delete"
          style="display: none;"
          title="{{ _('åˆ é™¤') }}"
        >
          ğŸ—‘
        </button>
        <a 
          href="{{ url('mindmap_card_edit_branch', domainId=mindMap.domainId, docId=mindMap.docId, branch=branch, nodeId=nodeId) }}"
          class="mindmap-card-list__action-btn mindmap-card-list__action-btn--new"
          style="text-decoration: none;"
          title="{{ _('æ–°å»º') }}"
        >
          +
        </a>
      </div>
    </div>
    <div id="card-list-container" class="mindmap-card-list__container">
      {% if cards and cards|length > 0 %}
        {% for card in cards %}
          <div
            class="mindmap-card-list__item card-item {% if selectedCard and card.docId.toString() == selectedCard.docId.toString() %}selected{% endif %}"
            data-card-id="{{ card.docId }}"
            data-order="{{ card.order or loop.index }}"
          >
            <div class="mindmap-card-list__item-content">
              <input 
                type="checkbox" 
                class="mindmap-card-list__checkbox card-checkbox" 
                data-card-id="{{ card.docId }}"
              />
              <span class="mindmap-card-list__drag-handle drag-handle">â‹®â‹®</span>
              <div class="mindmap-card-list__item-title">
                {{ card.title or 'æœªå‘½åå¡ç‰‡' }}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="mindmap-card-list__empty">
          <p class="mindmap-card-list__empty-text">æš‚æ— å¡ç‰‡</p>
        </div>
      {% endif %}
    </div>
  </div>
  
  <!-- å³ä¾§ï¼šå¡ç‰‡å†…å®¹ -->
  <div class="mindmap-card-list__content">
    <div class="section">
      <div class="section__header mindmap-card-list__content-header">
        <h1 class="section__title mindmap-card-list__content-title">
          <span id="card-title">{{ selectedCard.title if selectedCard else 'è¯·é€‰æ‹©å¡ç‰‡' }}</span>
          <span style="margin: 0 10px;">/</span>
          {% if nodePath and nodePath|length > 0 %}
            {% for pathNode in nodePath %}
              {{ pathNode.text }}
              <span style="margin: 0 10px;">/</span>
            {% endfor %}
          {% else %}
            {{ nodeText }}
            <span style="margin: 0 10px;">/</span>
          {% endif %}
          <a href="{{ url('mindmap_detail_branch', domainId=mindMap.domainId, docId=mindMap.docId, branch=branch) }}">
            {{ mindMap.title if mindMap else 'æ€ç»´å¯¼å›¾' }}
          </a>
        </h1>
        <a 
          id="card-edit-btn"
          href=""
          class="button primary mindmap-card-list__content-edit-btn"
          style="display: none;"
        >
          {{ _('ç¼–è¾‘') }}
        </a>
      </div>
      <div class="section__body">
        <div id="card-content" class="typo richmedia topic__content" data-emoji-enabled>
          {% if selectedCard and selectedCard.content %}
            {{ selectedCard.content|markdown|safe }}
          {% else %}
            <p style="color: #888;">{% if selectedCard %}æš‚æ— å†…å®¹{% else %}è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªå¡ç‰‡{% endif %}</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
