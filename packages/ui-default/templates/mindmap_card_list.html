{% extends "layout/basic.html" %}
{% block content %}
<script>
  {% set baseUrlValue = url("mindmap_card_list_branch", domainId=mindMap.domainId, docId=mindMap.docId, branch=branch, nodeId=nodeId) %}
  {{ set(UiContext, 'currentBranch', branch) }}
  {{ set(UiContext, 'mindMap', {
    domainId: mindMap.domainId,
    docId: mindMap.docId,
    mmid: mindMap.mmid,
    currentBranch: branch
  }) }}
  {{ set(UiContext, 'cards', cards) }}
  {{ set(UiContext, 'baseUrl', baseUrlValue) }}
  {{ set(UiContext, 'nodeId', nodeId) }}
</script>
<div class="row mindmap-card-list">
  <!-- 左侧：卡片列表侧边栏 -->
  <div class="mindmap-card-list__sidebar">
    <div class="mindmap-card-list__header">
      <h2 class="mindmap-card-list__title">卡片列表</h2>
      <div class="mindmap-card-list__actions">
        <button 
          id="edit-mode-btn"
          class="button primary mindmap-card-list__action-btn"
        >
          {{ _('编辑') }}
        </button>
        <button 
          id="save-order-btn"
          class="button success mindmap-card-list__action-btn"
          style="display: none;"
        >
          {{ _('保存') }}
        </button>
        <button 
          id="cancel-edit-btn"
          class="button mindmap-card-list__action-btn"
          style="display: none;"
        >
          {{ _('取消') }}
        </button>
        <a 
          href="{{ url('mindmap_card_edit_branch', domainId=mindMap.domainId, docId=mindMap.docId, branch=branch, nodeId=nodeId) }}"
          class="button primary mindmap-card-list__action-btn"
          style="text-decoration: none;"
        >
          {{ _('新建') }}
        </a>
      </div>
    </div>
    <div id="card-list-container" class="mindmap-card-list__container">
      {% if cards and cards|length > 0 %}
        {% for card in cards %}
          <div
            class="mindmap-card-list__item card-item {% if selectedCard and card.docId.toString() == selectedCard.docId.toString() %}selected{% endif %}"
            data-card-id="{{ card.docId }}"
            data-order="{{ card.order or loop.index }}"
          >
            <div class="mindmap-card-list__item-content">
              <span class="mindmap-card-list__drag-handle drag-handle">⋮⋮</span>
              <div class="mindmap-card-list__item-title">
                {{ card.title or '未命名卡片' }}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="mindmap-card-list__empty">
          <p class="mindmap-card-list__empty-text">暂无卡片</p>
        </div>
      {% endif %}
    </div>
  </div>
  
  <!-- 右侧：卡片内容 -->
  <div class="mindmap-card-list__content">
    <div class="section">
      <div class="section__header mindmap-card-list__content-header">
        <h1 class="section__title mindmap-card-list__content-title">
          <span id="card-title">{{ selectedCard.title if selectedCard else '请选择卡片' }}</span>
          <span style="margin: 0 10px;">/</span>
          {% if nodePath and nodePath|length > 0 %}
            {% for pathNode in nodePath %}
              {{ pathNode.text }}
              <span style="margin: 0 10px;">/</span>
            {% endfor %}
          {% else %}
            {{ nodeText }}
            <span style="margin: 0 10px;">/</span>
          {% endif %}
          <a href="{{ url('mindmap_detail_branch', domainId=mindMap.domainId, docId=mindMap.docId, branch=branch) }}">
            {{ mindMap.title if mindMap else '思维导图' }}
          </a>
        </h1>
        {% if selectedCard %}
          <a 
            href="{{ url('mindmap_card_edit_branch_with_card', domainId=mindMap.domainId, docId=mindMap.docId, branch=branch, nodeId=nodeId, cardId=selectedCard.docId) }}"
            class="button primary mindmap-card-list__content-edit-btn"
          >
            {{ _('编辑') }}
          </a>
        {% endif %}
      </div>
      <div class="section__body">
        <div id="card-content" class="typo richmedia topic__content" data-emoji-enabled>
          {% if selectedCard and selectedCard.content %}
            {{ selectedCard.content|markdown|safe }}
          {% else %}
            <p style="color: #888;">{% if selectedCard %}暂无内容{% else %}请从左侧选择一个卡片{% endif %}</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
