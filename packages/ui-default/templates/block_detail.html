{% extends "layout/basic.html" %}
<script>
  {{ set(UiContext, {
    block: block,
    ddoc: ddoc
  }) }}
</script>
{% block content %}
<div class="row">
  <div class="medium-3 columns">
    <!-- 文档树侧边栏 -->
    <div class="section side">
      <div class="section__header">
        <h2 class="section__title">{{ _("Document Structure") }}</h2>
      </div>
      <div class="section__body">
        <div id="doc-tree-container">
          <div id="doc-tree"></div>
        </div>
      </div>
    </div>

    <!-- Block 信息 -->
    <div class="section side">
      <div class="section__header">
        <h2 class="section__title">{{ _("Block Info") }}</h2>
      </div>
      <div class="section__body">
        <p><strong>{{ _("Author") }}:</strong> {{ udoc.uname if udoc else 'Unknown' }}</p>
        <p><strong>{{ _("Views") }}:</strong> {{ block.views }}</p>
        <p><strong>{{ _("Created") }}:</strong> {{ datetimeSpan(block.createdAt)|safe if block.createdAt else 'N/A' }}</p>
        <p><strong>{{ _("Updated") }}:</strong> {{ datetimeSpan(block.updateAt)|safe if block.updateAt else 'N/A' }}</p>
      </div>
    </div>

    <!-- 操作按钮 -->
    <div class="section">
      <div class="section__header">
        <h2 class="section__title">{{ _("Actions") }}</h2>
      </div>
      <div class="section__body">
        <ul class="menu">
          <li class="menu__item">
            <a class="menu__link" href="{{ url('doc_detail_branch', domainId=ddoc.domainId, rpid=ddoc.rpid, branch=currentBranch, did=ddoc.did) }}">
              <span class="icon icon-chevron-left"></span> {{ _('Back to Doc') }}
            </a>
          </li>
          <li class="menu__item">
            <a class="menu__link" href="{{ url('repo_detail_branch', domainId=block.domainId, rpid=block.rpid, branch=currentBranch) }}">
              <span class="icon icon-chevron-left"></span> {{ _('Back to Repo') }}
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="medium-9 columns">
    <div class="section">
      <div class="section__body">
        <ul class="supplementary list">
          <li><h2>{{ block.title }}</h2></li>
          <li>
            {{ user.render_inline(udoc) }}
            @
            {{ datetimeSpan(block._id)|safe }}
          </li>
        </ul>
        <div class="typo richmedia topic__content" data-emoji-enabled>
          {{ block.content|markdown|safe }}
        </div>
      </div>
      <ul class="section__footer supplementary dot list">
      {% if handler.user.own(block) or handler.user.hasPriv(PRIV.PRIV_EDIT_SYSTEM) %}
        <li><a href="{{ url('block_edit', domainId=block.domainId, rpid=block.rpid, did=block.did, bid=block.bid) }}">
          <span class="icon icon-edit"></span> {{ _('Edit') }}
        </a></li>
      {% endif %}
        <li>{{ _('{0} views').format(block.views) }}</li>
        <li><a href="{{ url('doc_detail_branch', domainId=ddoc.domainId, rpid=ddoc.rpid, branch=currentBranch, did=ddoc.did) }}">
          <span class="icon icon-chevron-left"></span> {{ _('Back to Doc') }}
        </a></li>
        <li><a href="{{ url('repo_detail_branch', domainId=block.domainId, rpid=block.rpid, branch=currentBranch) }}">
          <span class="icon icon-chevron-left"></span> {{ _('Back to Repo') }}
        </a></li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
