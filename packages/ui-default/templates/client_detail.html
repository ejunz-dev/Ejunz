{% set page_name = "client_detail" %}
{% extends "layout/basic.html" %}
{% block content %}
<div class="row">
    <div class="medium-9 columns">
        <div class="section">
            <div class="section__header">
                <h1 class="section__title">{{ client.name }}</h1>
                <div class="section__action">
                    <span class="client-status client-status-{{ client.status }}">
                        {% if client.status == 'connected' %}
                            {{ _('Connected') }}
                        {% elif client.status == 'disconnected' %}
                            {{ _('Disconnected') }}
                        {% elif client.status == 'error' %}
                            {{ _('Error') }}
                        {% else %}
                            {{ client.status }}
                        {% endif %}
                    </span>
                </div>
            </div>
            <div class="section__body">
                {% if client.description %}
                    <p>{{ client.description }}</p>
                {% endif %}
                
                <!-- 组件控制区域 -->
                <div class="widget-control-section" style="margin-top: 30px; padding-top: 30px; border-top: 1px solid #e0e0e0;">
                    <h3>{{ _('Widget Control') }}</h3>
                    <p class="help-text">{{ _('Control the visibility of projection widgets') }}</p>
                    <div id="widget-controls-container" class="widget-controls-container">
                        <!-- 组件开关将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="medium-3 columns">
        <div class="section">
            <div class="section__header">
                <h1 class="section__title">{{ _('Operations') }}</h1>
            </div>
            <div class="section__body">
                <a href="{{ url('client_domain', { domainId: domainId }) }}" class="button block">{{ _('Back to List') }}</a>
                {% if handler.user.hasPriv(model.builtin.PRIV.PRIV_USER_PROFILE) %}
                    <a href="{{ url('client_settings', { domainId: domainId, clientId: client.clientId }) }}" class="button block">{{ _('Configuration') }}</a>
                    <a href="{{ url('client_edit', { domainId: domainId, clientId: client.clientId }) }}" class="button block">{{ _('Edit Client') }}</a>
                    <a href="{{ url('client_logs', { domainId: domainId, clientId: client.clientId }) }}" class="button block">{{ _('View Connection Logs') }}</a>
                    <a href="{{ url('client_chat_list', { domainId: domainId, clientId: client.clientId }) }}" class="button block">{{ _('View Chat History') }}</a>
                    <div class="client-token-section">
                        <h4>{{ _('WebSocket Token Management') }}</h4>
                        {% if client.wsToken %}
                            <div class="token-info">
                                <p><strong>{{ _('Token') }}:</strong> <code id="ws-token">{{ client.wsToken }}</code></p>
                                {% if wsEndpoint %}
                                    <p><strong>{{ _('Connection URL') }}:</strong></p>
                                    <div class="endpoint-url">
                                        <code id="ws-endpoint">{{ wsEndpoint }}</code>
                                        <button class="button small client-copy-endpoint-btn">{{ _('Copy') }}</button>
                                    </div>
                                {% endif %}
                                <button class="button block danger client-delete-token-btn" data-client-id="{{ client.clientId }}">{{ _('Delete Token') }}</button>
                            </div>
                        {% else %}
                            <p>{{ _('Token not generated yet') }}</p>
                            <p class="text-gray" style="font-size: 0.9em;">{{ _('Please generate token on') }} <a href="{{ url('edge_main', { domainId: domainId }) }}">{{ _('Edge page') }}</a></p>
                        {% endif %}
                    </div>
                    <form method="post" action="{{ url('client_delete', { domainId: domainId }) }}" class="client-delete-form">
                        <input type="hidden" name="clientId" value="{{ client.clientId }}">
                        <button type="submit" class="button block danger client-delete-btn">{{ _('Delete Client') }}</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div id="client-status-ws" 
    data-client-id="{{ client.clientId }}"
    data-domain-id="{{ domainId }}"
    class="client-status-ws">
</div>
{% endblock %}

