{% extends "layout/basic.html" %}
{% block content %}
<script>
  {{ set(UiContext, 'currentBranch', branch) }}
  {{ set(UiContext, 'base', {
    domainId: base.domainId,
    docId: base.docId,
    bid: base.bid,
    currentBranch: branch
  }) }}
</script>
<div class="row">
  <div class="large-9 columns">
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">
          <a href="{{ url('base_detail_branch', domainId=base.domainId, docId=base.docId, branch=branch) }}">
            {{ base.title if base else '思维导图' }}
          </a>
          <span style="margin: 0 10px;">/</span>
          {{ card.title if card else '卡片' }}
        </h1>
      </div>
      <div class="section__body">
        <div class="typo richmedia topic__content" data-emoji-enabled>
          {{ card.content|markdown|safe if card and card.content else '<p style="color: #888;">暂无内容</p>' }}
        </div>
      </div>
    </div>
  </div>
  
  <div class="large-3 columns">
    <div class="section">
      <div class="section__header">
        <h2 class="section__title">{{ _('Card List') }}</h2>
      </div>
      <div class="section__body">
        {% if cards and cards|length > 0 %}
          <div style="display: flex; flex-direction: column; gap: 8px;">
            {% for c in cards %}
              <a 
                href="{{ url('base_card_detail_branch', domainId=base.domainId, docId=base.docId, branch=branch, nodeId=nodeId, cardId=c.docId) }}"
                style="
                  padding: 12px 16px;
                  border-radius: 6px;
                  text-decoration: none;
                  color: #333;
                  background: {% if c.docId.toString() == card.docId.toString() %}#e3f2fd{% else %}#fff{% endif %};
                  border: {% if c.docId.toString() == card.docId.toString() %}2px solid #2196f3{% else %}1px solid #e0e0e0{% endif %};
                  transition: all 0.2s ease;
                  display: block;
                "
                onmouseover="this.style.background='{% if c.docId.toString() == card.docId.toString() %}#e3f2fd{% else %}#f5f5f5{% endif %}';"
                onmouseout="this.style.background='{% if c.docId.toString() == card.docId.toString() %}#e3f2fd{% else %}#fff{% endif %}';"
              >
                <div style="font-size: 14px; font-weight: {% if c.docId.toString() == card.docId.toString() %}600{% else %}400{% endif %}; margin-bottom: 4px;">
                  {{ c.title or '未命名卡片' }}
                </div>
                {% if c.content %}
                  <div style="font-size: 12px; color: #666; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    {{ c.content|truncate(50) }}
                  </div>
                {% endif %}
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p style="color: #888;">暂无卡片</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

