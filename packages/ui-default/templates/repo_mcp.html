{% import "components/form.html" as form with context %}
{% extends "layout/basic.html" %}

{% block content %}
<div class="row">
  <div class="medium-12 columns">
    <div class="section">
      <div class="section__header">
        <h2 class="section__title">{{ _("Repo MCP Tools") }}</h2>
        <p class="section__help-text">
          {{ _("Manage MCP tools for this repo. These tools will be available when this repo is assigned to an agent.") }}
        </p>
      </div>
      <div class="section__body">
        {% if repo.edgeId %}
          {% if edge %}
            <div style="margin-bottom: 20px; padding: 12px; background-color: #e8f5e9; border: 1px solid #4caf50; border-radius: 4px;">
              <strong>{{ _('MCP Status') }}:</strong> {{ _('Activated') }}
              <br>
              <small style="color: #666;">{{ _('Edge ID') }}: {{ edge.eid }}</small>
            </div>
          {% endif %}
          
          <!-- MCP Tools List -->
          <div class="mcp-tools-list">
            {% if mcpTools and mcpTools.length > 0 %}
              <p class="note" style="margin-bottom: 15px;">
                {{ _('These tools are automatically generated when MCP is activated. They will be available when this repo is assigned to an agent.') }}
              </p>
              <table class="data-table">
                <thead>
                  <tr>
                    <th>{{ _('Tool Name') }}</th>
                    <th>{{ _('Description') }}</th>
                    <th>{{ _('Type') }}</th>
                    <th>{{ _('Details') }}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for tool in mcpTools %}
                  <tr>
                    <td><code>{{ tool.name }}</code></td>
                    <td style="max-width: 400px; word-wrap: break-word;">{{ tool.description }}</td>
                    <td>
                      {% if 'query' in tool.name %}
                        <span class="badge badge--success">{{ _('Query') }}</span>
                      {% elif 'create' in tool.name %}
                        <span class="badge badge--primary">{{ _('Create') }}</span>
                      {% elif 'edit' in tool.name %}
                        <span class="badge badge--warning">{{ _('Edit') }}</span>
                      {% elif 'delete' in tool.name %}
                        <span class="badge badge--danger">{{ _('Delete') }}</span>
                      {% else %}
                        <span class="badge">{{ _('Custom') }}</span>
                      {% endif %}
                      {% if 'doc' in tool.name %}
                        <span class="badge" style="margin-left: 5px;">{{ _('Document') }}</span>
                      {% elif 'block' in tool.name %}
                        <span class="badge" style="margin-left: 5px;">{{ _('Block') }}</span>
                      {% endif %}
                    </td>
                    <td>
                      <details style="font-size: 0.85em;">
                        <summary style="cursor: pointer;">{{ _('View Schema') }}</summary>
                        <pre style="margin-top: 5px; padding: 5px; background: #f5f5f5; border-radius: 3px; overflow-x: auto;">{{ tool.inputSchema|json }}</pre>
                      </details>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="note">{{ _('No MCP tools found. Tools should be automatically generated when MCP is activated.') }}</p>
            {% endif %}
          </div>
        {% elif repo.mcpServerId %}
          <!-- 兼容旧方式 -->
          <p class="note">{{ _('This repo is using the legacy MCP server. Please activate MCP to use the new edge-based system.') }}</p>
        {% else %}
          <p class="note">
            {{ _('MCP is not activated for this repo.') }}
            <br>
            <a href="{{ url('repo_detail', domainId=repo.domainId, rpid=repo.rpid) }}" class="button primary" style="margin-top: 10px;">
              {{ _('Go to Repo Detail to Activate MCP') }}
            </a>
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

